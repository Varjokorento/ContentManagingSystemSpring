<!doctype html>
<html class="no-js" lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate CMS</title>
<link rel="stylesheet" th:href="@{/foundation.css}"/>
<link rel="stylesheet" th:href="@{/app.css}"/>
<link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:900|Poppins" rel="stylesheet">
<script src='https://cloud.tinymce.com/stable/tinymce.min.js'></script>

<!--    Post editor and file upload codes-->

<script>

    tinymce.init({
        selector: '#postfield',
        plugins: 'code, image',
        menubar: false,
        file_picker_types: 'file image media',
        image_title: true,
        automatic_uploads: true,
        file_picker_types: 'image',
        file_picker_callback: function (cb, value, meta) {
            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.onchange = function () {
                var file = this.files[0];
                var reader = new FileReader();
                reader.onload = function () {
                    var id = 'blobid' + (new Date()).getTime();
                    var blobCache = tinymce.activeEditor.editorUpload.blobCache;
                    var base64 = reader.result.split(',')[1];
                    var blobInfo = blobCache.create(id, file, base64);
                    blobCache.add(blobInfo);
                    cb(blobInfo.blobUri(), {title: file.name});
                };
                reader.readAsDataURL(file);
            };

            input.click();
        }
    });

</script>

<!--End of post editor and file upload code-->


</head>
<body>

<div th:replace="/fragments/template :: navigation"></div>

<div class="grid-x" data-equalizer="foo">
    <div class="cell medium-8">
        <div class="callout panel" data-equalizer-watch="foo">

            <!--Get five posts to page (Latest first)-->

            <tr th:each="post : *{showposts}">
                <div class="primary callout" id="posts">
                    <a th:href="@{/post/{_id}/(_id=${post.id})}"><h4 th:text="${post.title}"></h4></a>
                    <h6 th:text="${#dates.format(post.date, 'dd/MM/yyyy HH:mm')}"></h6>
                    <p th:utext="${post.text}"></p>

                    <!--Edit / Delete button group-->

                    <div class="tiny button-group" style="float: right;">
                        <a type="button" class="button tiny" th:href="@{/post/{_id}/edit/(_id=${post.id})}">Edit</a>
                        <a type="button" class="alert button tiny" th:attr="data-open=${post.id}">Delete Post</a>

                    </div>

                    <!--End of button group-->

                </div>

                <!--Confirmation window for delete post-->

                <div class="reveal" th:id="${post.id}" data-reveal>
                    <h4>Are you sure?</h4>

                    <a type="button" class="alert button" th:href="@{/post/delete/{_id}/(_id=${post.id})}">Delete
                        post</a>
                    <button class="close-button" data-close aria-label="Close modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <!--End of confirmation windows-->

            </tr>

        </div>
    </div>

    <div th:replace="/fragments/popularpost :: popularposts"></div>

    <th th:replace="/fragments/footer :: footer"></th>

</body>
</html>
